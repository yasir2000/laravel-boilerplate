<!DOCTYPE html>
<html>
<head>
    <title>HR Management System</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/extjs/6.2.0/classic/theme-triton/resources/theme-triton-all.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f0f0;
        }
        
        .desktop-wallpaper {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        
        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(to bottom, #4a90e2, #357abd);
            border-top: 1px solid #2968a3;
            z-index: 10000;
            display: flex;
            align-items: center;
            padding: 0 10px;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.3);
        }
        
        .start-button {
            background: linear-gradient(to bottom, #5ba0f2, #4a90e2);
            border: 1px solid #357abd;
            border-radius: 3px;
            padding: 5px 15px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin-right: 10px;
            box-shadow: inset 0 1px rgba(255,255,255,0.3);
        }
        
        .start-button:hover {
            background: linear-gradient(to bottom, #6bb0ff, #5ba0f2);
        }
        
        .taskbar-items {
            flex: 1;
            display: flex;
            gap: 2px;
        }
        
        .taskbar-item {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 3px 10px;
            color: white;
            font-size: 11px;
            cursor: pointer;
            border-radius: 2px;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .taskbar-item:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .taskbar-item.active {
            background: rgba(255,255,255,0.3);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }
        
        .system-tray {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            font-size: 11px;
        }
        
        .desktop-icon {
            position: absolute;
            width: 80px;
            text-align: center;
            cursor: pointer;
            user-select: none;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }
        
        .desktop-icon img {
            width: 48px;
            height: 48px;
            margin-bottom: 5px;
            filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.5));
        }
        
        .desktop-icon span {
            display: block;
            font-size: 12px;
            line-height: 1.2;
        }
        
        .desktop-icon:hover {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            padding: 5px;
            margin: -5px;
        }
    </style>
</head>
<body>
    <div class="desktop-wallpaper"></div>
    
    <!-- Desktop Icons -->
    <div class="desktop-icon" style="top: 20px; left: 20px;" onclick="HRApp.openModule('employees')">
        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjNGE5MGUyIj48cGF0aCBkPSJNMTIgMTJjMi4yMSAwIDQtMS43OSA0LTRzLTEuNzktNC00LTQtNCAxLjc5LTQgNHMxLjc5IDQgNCA0em0wIDJjLTIuNjcgMC04IDEuMzQtOCA0djJoMTZ2LTJjMC0yLjY2LTUuMzMtNC04LTR6Ii8+PC9zdmc+" alt="Employees">
        <span>Employee Management</span>
    </div>
    
    <div class="desktop-icon" style="top: 20px; left: 120px;" onclick="HRApp.openModule('departments')">
        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjNGE5MGUyIj48cGF0aCBkPSJNMTkgM0g1Yy0xLjEgMC0yIC45LTIgMnYxNGMwIDEuMS45IDIgMiAyaDE0YzEuMSAwIDItLjkgMi0yVjVjMC0xLjEtLjktMi0yLTJ6bS01IDEzaC0xLjNsLTIuMi0yLjJjLjQtLjUuNy0xLjEuNy0xLjh2LS41YzEuNi0uNCAyLjctMS45IDIuNy0zLjVWN2MwLTEuOS0xLjYtMy41LTMuNS0zLjVTNy41IDUuMSA3LjUgN3YuNWMwIDEuNiAxIDMuMSAyLjcgMy41di41YzAgLjctLjMgMS4zLS43IDEuOEw3IDEzaC0uM0M2LjMgMTMgNiAxMy4zIDYgMTMuN1YxNWgxLjN2LTEuM0g4bDEuNS0xLjVjLS4yLS4yLS4zLS41LS4zLS44di0uNWMtMS4yLS4zLTItMS4zLTItMi41VjdhMi41IDIuNSAwIDAgMSA1IDBWOC40YzAgMS4yLS44IDIuMi0yIDIuNXYuNWMwIC4zLS4xLjYtLjMuOEwxMSAxNGguN3YxSDEzeiIvPjwvc3ZnPg==" alt="Departments">
        <span>Department Management</span>
    </div>
    
    <div class="desktop-icon" style="top: 20px; left: 220px;" onclick="HRApp.openModule('attendance')">
        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjNGE5MGUyIj48cGF0aCBkPSJNMTIgMkM2LjUgMiAyIDYuNSAyIDEyczQuNSAxMCAxMCAxMCAxMC00LjUgMTAtMTBTMTcuNSAyIDEyIDJ6bTMuNiA2TDEyIDEwLjZWNkg4djJoNHY0LjZsMyAzIDEuNC0xLjRMMTMuNiA4eiIvPjwvc3ZnPg==" alt="Attendance">
        <span>Attendance Tracking</span>
    </div>
    
    <div class="desktop-icon" style="top: 120px; left: 20px;" onclick="HRApp.openModule('positions')">
        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjNGE5MGUyIj48cGF0aCBkPSJNMjAgNmgtMi4xOGwuNjgtLjY4Yy40NS0uNDUuNDUtMS4xNyAwLTEuNjItLjQ1LS40NS0xLjE3LS40NS0xLjYyIDBMMTQuMTQgNkg5Ljg2TDcuMTIgMy4zYy0uNDUtLjQ1LTEuMTctLjQ1LTEuNjIgMC0uNDUuNDUtLjQ1IDEuMTcgMCAxLjYyTC42IDZINGMtMS4xIDAtMiAuOS0yIDJ2MTBjMCAxLjEuOSAyIDIgMmgxNmMxLjEgMCAyLS45IDItMlY4YzAtMS4xLS45LTItMi0yem0tOCAxMnYtNkg5djZoM3ptMiAwaDN2LTZoLTN2NnptMiAwaDJ2LTZoLTJ2NnptMi0xMGgtNFY2aDR2MnoiLz48L3N2Zz4=" alt="Positions">
        <span>Position Management</span>
    </div>
    
    <div class="desktop-icon" style="top: 120px; left: 120px;" onclick="HRApp.openModule('leave')">
        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjNGE5MGUyIj48cGF0aCBkPSJNMTkgM0g1Yy0xLjEgMC0yIC45LTIgMnYxNGMwIDEuMS45IDIgMiAyaDE0YzEuMSAwIDItLjkgMi0yVjVjMC0xLjEtLjktMi0yLTJ6bS01IDEzaC0xLjNsLTIuMi0yLjJjLjQtLjUuNy0xLjEuNy0xLjh2LS41YzEuNi0uNCAyLjctMS45IDIuNy0zLjVWN2MwLTEuOS0xLjYtMy41LTMuNS0zLjVTNy41IDUuMSA3LjUgN3YuNWMwIDEuNiAxIDMuMSAyLjcgMy41di41YzAgLjctLjMgMS4zLS43IDEuOEw3IDEzaC0uM0M2LjMgMTMgNiAxMy4zIDYgMTMuN1YxNWgxLjN2LTEuM0g4bDEuNS0xLjVjLS4yLS4yLS4zLS41LS4zLS44di0uNWMtMS4yLS4zLTItMS4zLTItMi41VjdhMi41IDIuNSAwIDAgMSA1IDBWOC40YzAgMS4yLS44IDIuMi0yIDIuNXYuNWMwIC4zLS4xLjYtLjMuOEwxMSAxNGguN3YxSDEzeiIvPjwvc3ZnPg==" alt="Leave">
        <span>Leave Requests</span>
    </div>
    
    <div class="desktop-icon" style="top: 120px; left: 220px;" onclick="HRApp.openModule('evaluations')">
        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjNGE5MGUyIj48cGF0aCBkPSJNMTIgMkMxMy4xIDIgMTQgMi45IDE0IDRjMCAxLjEtLjkgMi0yIDJzLTItLjktMi0yQzEwIDIuOSAxMC45IDIgMTIgMnptLTEgOWMwLTEuMSAuOS0yIDItMnMxLjEgMiAyaDNjMiAuOC0yIDQtNCBzLTItMS44LTItNHptMTEgM2MwIDIuMjEtMS43OSA0LTQgNHMtNC0xLjc5LTQtNGMwLTEuNjYgMS4zNC0zIDMtM3MzIDEuMzQgMyAzeiIvPjwvc3ZnPg==" alt="Evaluations">
        <span>Performance Evaluations</span>
    </div>
    
    <div class="desktop-icon" style="top: 220px; left: 20px;" onclick="HRApp.openModule('reports')">
        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjNGE5MGUyIj48cGF0aCBkPSJNMTkgM0g1Yy0xLjEgMC0yIC45LTIgMnYxNGMwIDEuMS45IDIgMiAyaDE0YzEuMSAwIDItLjkgMi0yVjVjMC0xLjEtLjktMi0yLTJ6bS01IDEzSDZsNS01IDIgMiAyLTJWN2MwLS41NS0uNDUtMS0xLTFzLTEgLjQ1LTEgMXY2LjU4bC0yLTJjLS4yOC0uMjgtLjY5LS4yOC0uOTcgMGwtNC41NCA0LjU0Yy0uMjIuMjItLjU4LjIyLS44IDBjLS4yMi0uMjItLjIyLS41OCAwLS44bDEuMzEtMS4zM2MuNS0uNSAxLjMxLS41IDEuODEgMEw2IDdWNWMwLS4zOC4yNi0uNy42My0uNzhMNy41IDMuNWMuMzMtLjIzLjc2LS4yMyAxLjEgMEw5LjM3IDQuMjJjLjM3LjA4LjYzLjQuNjMuNzh2M2MwIDEuNjYtMS4zNCAzLTMgM3pNMTAgM2MtLjU1IDAtMS0uNDUtMS0xczQuNDUtMSAxLTEgMSA0NSAxIDEtLjQ1IDEtMSAxeiIvPjwvc3ZnPg==" alt="Reports">
        <span>Reports & Analytics</span>
    </div>
    
    <div class="desktop-icon" style="top: 220px; left: 120px;" onclick="HRApp.openModule('dashboard')">
        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjNGE5MGUyIj48cGF0aCBkPSJNMyAzdjE4aDEwVjNoMTB2MThoMlYzSDEzeiIvPjxwYXRoIGQ9Ik03IDE2aDJ2LTJIN3Yyem04LThIOXYyaDJ2LTJ6bTAtM0g5djJoMlY1em0wIDZIOXYyaDJWMTF6Ii8+PC9zdmc+" alt="Dashboard">
        <span>HR Dashboard</span>
    </div>
    
    <!-- Taskbar -->
    <div class="taskbar">
        <div class="start-button" onclick="HRApp.toggleStartMenu()">
            âŠž Start
        </div>
        <div class="taskbar-items" id="taskbar-items">
            <!-- Dynamic taskbar items will be added here -->
        </div>
        <div class="system-tray">
            <span id="current-time"></span>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/extjs/6.2.0/ext-all.js"></script>
    <script>
        // HR Application Main Class
        window.HRApp = {
            openWindows: {},
            nextZIndex: 1000,
            
            init: function() {
                this.updateTime();
                setInterval(() => this.updateTime(), 1000);
                
                // Initialize CSRF token for AJAX requests
                Ext.Ajax.setDefaultHeaders({
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || ''
                });
            },
            
            updateTime: function() {
                const now = new Date();
                const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const dateString = now.toLocaleDateString();
                document.getElementById('current-time').innerHTML = `${timeString}<br>${dateString}`;
            },
            
            openModule: function(module) {
                if (this.openWindows[module]) {
                    this.openWindows[module].show();
                    this.openWindows[module].toFront();
                    return;
                }
                
                let config = this.getModuleConfig(module);
                config.listeners = {
                    close: function() {
                        delete HRApp.openWindows[module];
                        HRApp.updateTaskbar();
                    },
                    minimize: function() {
                        this.hide();
                    },
                    show: function() {
                        HRApp.updateTaskbar();
                    }
                };
                
                this.openWindows[module] = Ext.create('Ext.window.Window', config);
                this.openWindows[module].show();
                this.updateTaskbar();
            },
            
            getModuleConfig: function(module) {
                const configs = {
                    employees: {
                        title: 'Employee Management',
                        width: 800,
                        height: 600,
                        layout: 'border',
                        items: this.createEmployeePanel()
                    },
                    departments: {
                        title: 'Department Management',
                        width: 700,
                        height: 500,
                        layout: 'border',
                        items: this.createDepartmentPanel()
                    },
                    attendance: {
                        title: 'Attendance Tracking',
                        width: 900,
                        height: 600,
                        layout: 'border',
                        items: this.createAttendancePanel()
                    },
                    positions: {
                        title: 'Position Management',
                        width: 700,
                        height: 500,
                        layout: 'border',
                        items: this.createPositionPanel()
                    },
                    leave: {
                        title: 'Leave Requests',
                        width: 800,
                        height: 600,
                        layout: 'border',
                        items: this.createLeavePanel()
                    },
                    evaluations: {
                        title: 'Performance Evaluations',
                        width: 800,
                        height: 600,
                        layout: 'border',
                        items: this.createEvaluationPanel()
                    },
                    reports: {
                        title: 'Reports & Analytics',
                        width: 900,
                        height: 650,
                        layout: 'border',
                        items: this.createReportsPanel()
                    },
                    dashboard: {
                        title: 'HR Dashboard',
                        width: 1000,
                        height: 700,
                        layout: 'border',
                        items: this.createDashboardPanel()
                    }
                };
                
                return configs[module] || { title: 'Unknown Module', width: 400, height: 300 };
            },
            
            createEmployeePanel: function() {
                return [{
                    region: 'center',
                    xtype: 'grid',
                    store: this.createStore('/api/employees', {
                        id: 'number',
                        first_name: 'string',
                        last_name: 'string',
                        email: 'string',
                        phone: 'string',
                        department_id: 'number',
                        position_id: 'number',
                        hire_date: 'date',
                        salary: 'number',
                        status: 'string'
                    }),
                    columns: [
                        { text: 'ID', dataIndex: 'id', width: 60 },
                        { text: 'First Name', dataIndex: 'first_name', width: 120 },
                        { text: 'Last Name', dataIndex: 'last_name', width: 120 },
                        { text: 'Email', dataIndex: 'email', width: 180 },
                        { text: 'Phone', dataIndex: 'phone', width: 120 },
                        { text: 'Department', dataIndex: 'department_name', width: 120 },
                        { text: 'Position', dataIndex: 'position_name', width: 120 },
                        { text: 'Hire Date', dataIndex: 'hire_date', width: 100, xtype: 'datecolumn', format: 'M d, Y' },
                        { text: 'Salary', dataIndex: 'salary', width: 100, xtype: 'numbercolumn', format: '$0,000' },
                        { text: 'Status', dataIndex: 'status', width: 80 }
                    ],
                    tbar: [
                        { text: 'Add Employee', iconCls: 'fa fa-plus', handler: function() { HRApp.showEmployeeForm(); } },
                        { text: 'Edit Employee', iconCls: 'fa fa-edit', handler: function() { HRApp.showEmployeeForm('edit'); } },
                        { text: 'Delete Employee', iconCls: 'fa fa-trash', handler: function() { HRApp.deleteEmployee(); } },
                        '-',
                        { text: 'Refresh', iconCls: 'fa fa-refresh', handler: function() { this.up('grid').getStore().reload(); } }
                    ]
                }];
            },
            
            createDepartmentPanel: function() {
                return [{
                    region: 'center',
                    xtype: 'grid',
                    store: this.createStore('/api/departments', {
                        id: 'number',
                        name: 'string',
                        description: 'string',
                        manager_id: 'number',
                        budget: 'number',
                        created_at: 'date'
                    }),
                    columns: [
                        { text: 'ID', dataIndex: 'id', width: 60 },
                        { text: 'Department Name', dataIndex: 'name', width: 200 },
                        { text: 'Description', dataIndex: 'description', width: 300, flex: 1 },
                        { text: 'Manager', dataIndex: 'manager_name', width: 150 },
                        { text: 'Budget', dataIndex: 'budget', width: 120, xtype: 'numbercolumn', format: '$0,000' },
                        { text: 'Created', dataIndex: 'created_at', width: 100, xtype: 'datecolumn', format: 'M d, Y' }
                    ],
                    tbar: [
                        { text: 'Add Department', iconCls: 'fa fa-plus', handler: function() { HRApp.showDepartmentForm(); } },
                        { text: 'Edit Department', iconCls: 'fa fa-edit', handler: function() { HRApp.showDepartmentForm('edit'); } },
                        { text: 'Delete Department', iconCls: 'fa fa-trash', handler: function() { HRApp.deleteDepartment(); } },
                        '-',
                        { text: 'Refresh', iconCls: 'fa fa-refresh', handler: function() { this.up('grid').getStore().reload(); } }
                    ]
                }];
            },
            
            createAttendancePanel: function() {
                return [{
                    region: 'center',
                    xtype: 'grid',
                    store: this.createStore('/api/attendance', {
                        id: 'number',
                        employee_id: 'number',
                        date: 'date',
                        clock_in: 'string',
                        clock_out: 'string',
                        break_duration: 'number',
                        total_hours: 'number',
                        status: 'string'
                    }),
                    columns: [
                        { text: 'ID', dataIndex: 'id', width: 60 },
                        { text: 'Employee', dataIndex: 'employee_name', width: 150 },
                        { text: 'Date', dataIndex: 'date', width: 100, xtype: 'datecolumn', format: 'M d, Y' },
                        { text: 'Clock In', dataIndex: 'clock_in', width: 100 },
                        { text: 'Clock Out', dataIndex: 'clock_out', width: 100 },
                        { text: 'Break (min)', dataIndex: 'break_duration', width: 80 },
                        { text: 'Total Hours', dataIndex: 'total_hours', width: 80, xtype: 'numbercolumn', format: '0.00' },
                        { text: 'Status', dataIndex: 'status', width: 100 }
                    ],
                    tbar: [
                        { text: 'Clock In', iconCls: 'fa fa-clock-o', handler: function() { HRApp.clockAction('in'); } },
                        { text: 'Clock Out', iconCls: 'fa fa-clock-o', handler: function() { HRApp.clockAction('out'); } },
                        '-',
                        { text: 'Add Record', iconCls: 'fa fa-plus', handler: function() { HRApp.showAttendanceForm(); } },
                        { text: 'Edit Record', iconCls: 'fa fa-edit', handler: function() { HRApp.showAttendanceForm('edit'); } },
                        '-',
                        { text: 'Refresh', iconCls: 'fa fa-refresh', handler: function() { this.up('grid').getStore().reload(); } }
                    ]
                }];
            },
            
            createPositionPanel: function() {
                return [{
                    region: 'center',
                    xtype: 'grid',
                    store: this.createStore('/api/positions', {
                        id: 'number',
                        title: 'string',
                        description: 'string',
                        department_id: 'number',
                        min_salary: 'number',
                        max_salary: 'number',
                        requirements: 'string'
                    }),
                    columns: [
                        { text: 'ID', dataIndex: 'id', width: 60 },
                        { text: 'Position Title', dataIndex: 'title', width: 200 },
                        { text: 'Department', dataIndex: 'department_name', width: 150 },
                        { text: 'Min Salary', dataIndex: 'min_salary', width: 100, xtype: 'numbercolumn', format: '$0,000' },
                        { text: 'Max Salary', dataIndex: 'max_salary', width: 100, xtype: 'numbercolumn', format: '$0,000' },
                        { text: 'Description', dataIndex: 'description', width: 300, flex: 1 }
                    ],
                    tbar: [
                        { text: 'Add Position', iconCls: 'fa fa-plus', handler: function() { HRApp.showPositionForm(); } },
                        { text: 'Edit Position', iconCls: 'fa fa-edit', handler: function() { HRApp.showPositionForm('edit'); } },
                        { text: 'Delete Position', iconCls: 'fa fa-trash', handler: function() { HRApp.deletePosition(); } },
                        '-',
                        { text: 'Refresh', iconCls: 'fa fa-refresh', handler: function() { this.up('grid').getStore().reload(); } }
                    ]
                }];
            },
            
            createLeavePanel: function() {
                return [{
                    region: 'center',
                    xtype: 'grid',
                    store: this.createStore('/api/leave-requests', {
                        id: 'number',
                        employee_id: 'number',
                        type: 'string',
                        start_date: 'date',
                        end_date: 'date',
                        days_requested: 'number',
                        reason: 'string',
                        status: 'string',
                        approved_by: 'number'
                    }),
                    columns: [
                        { text: 'ID', dataIndex: 'id', width: 60 },
                        { text: 'Employee', dataIndex: 'employee_name', width: 150 },
                        { text: 'Type', dataIndex: 'type', width: 100 },
                        { text: 'Start Date', dataIndex: 'start_date', width: 100, xtype: 'datecolumn', format: 'M d, Y' },
                        { text: 'End Date', dataIndex: 'end_date', width: 100, xtype: 'datecolumn', format: 'M d, Y' },
                        { text: 'Days', dataIndex: 'days_requested', width: 60 },
                        { text: 'Status', dataIndex: 'status', width: 100 },
                        { text: 'Reason', dataIndex: 'reason', width: 200, flex: 1 }
                    ],
                    tbar: [
                        { text: 'New Request', iconCls: 'fa fa-plus', handler: function() { HRApp.showLeaveForm(); } },
                        { text: 'Edit Request', iconCls: 'fa fa-edit', handler: function() { HRApp.showLeaveForm('edit'); } },
                        { text: 'Approve', iconCls: 'fa fa-check', handler: function() { HRApp.approveLeave(); } },
                        { text: 'Reject', iconCls: 'fa fa-times', handler: function() { HRApp.rejectLeave(); } },
                        '-',
                        { text: 'Refresh', iconCls: 'fa fa-refresh', handler: function() { this.up('grid').getStore().reload(); } }
                    ]
                }];
            },
            
            createEvaluationPanel: function() {
                return [{
                    region: 'center',
                    xtype: 'grid',
                    store: this.createStore('/api/evaluations', {
                        id: 'number',
                        employee_id: 'number',
                        evaluator_id: 'number',
                        period_start: 'date',
                        period_end: 'date',
                        overall_rating: 'number',
                        goals_rating: 'number',
                        skills_rating: 'number',
                        comments: 'string',
                        status: 'string'
                    }),
                    columns: [
                        { text: 'ID', dataIndex: 'id', width: 60 },
                        { text: 'Employee', dataIndex: 'employee_name', width: 150 },
                        { text: 'Evaluator', dataIndex: 'evaluator_name', width: 150 },
                        { text: 'Period Start', dataIndex: 'period_start', width: 100, xtype: 'datecolumn', format: 'M d, Y' },
                        { text: 'Period End', dataIndex: 'period_end', width: 100, xtype: 'datecolumn', format: 'M d, Y' },
                        { text: 'Overall Rating', dataIndex: 'overall_rating', width: 100, xtype: 'numbercolumn', format: '0.0' },
                        { text: 'Status', dataIndex: 'status', width: 100 }
                    ],
                    tbar: [
                        { text: 'New Evaluation', iconCls: 'fa fa-plus', handler: function() { HRApp.showEvaluationForm(); } },
                        { text: 'Edit Evaluation', iconCls: 'fa fa-edit', handler: function() { HRApp.showEvaluationForm('edit'); } },
                        { text: 'View Details', iconCls: 'fa fa-eye', handler: function() { HRApp.viewEvaluationDetails(); } },
                        '-',
                        { text: 'Refresh', iconCls: 'fa fa-refresh', handler: function() { this.up('grid').getStore().reload(); } }
                    ]
                }];
            },
            
            createReportsPanel: function() {
                return [{
                    region: 'west',
                    title: 'Report Categories',
                    width: 200,
                    xtype: 'treepanel',
                    store: Ext.create('Ext.data.TreeStore', {
                        root: {
                            expanded: true,
                            children: [
                                { text: 'Employee Reports', leaf: false, expanded: true, children: [
                                    { text: 'Employee List', leaf: true, reportType: 'employee-list' },
                                    { text: 'Employee Summary', leaf: true, reportType: 'employee-summary' },
                                    { text: 'New Hires', leaf: true, reportType: 'new-hires' }
                                ]},
                                { text: 'Attendance Reports', leaf: false, expanded: true, children: [
                                    { text: 'Daily Attendance', leaf: true, reportType: 'daily-attendance' },
                                    { text: 'Monthly Summary', leaf: true, reportType: 'monthly-attendance' },
                                    { text: 'Late Arrivals', leaf: true, reportType: 'late-arrivals' }
                                ]},
                                { text: 'Leave Reports', leaf: false, expanded: true, children: [
                                    { text: 'Leave Balance', leaf: true, reportType: 'leave-balance' },
                                    { text: 'Leave Requests', leaf: true, reportType: 'leave-requests' },
                                    { text: 'Leave History', leaf: true, reportType: 'leave-history' }
                                ]},
                                { text: 'Performance Reports', leaf: false, expanded: true, children: [
                                    { text: 'Evaluation Summary', leaf: true, reportType: 'evaluation-summary' },
                                    { text: 'Department Performance', leaf: true, reportType: 'dept-performance' }
                                ]}
                            ]
                        }
                    }),
                    listeners: {
                        itemclick: function(view, record) {
                            if (record.isLeaf()) {
                                HRApp.generateReport(record.get('reportType'));
                            }
                        }
                    }
                }, {
                    region: 'center',
                    xtype: 'tabpanel',
                    id: 'reports-tabs',
                    items: [{
                        title: 'Welcome',
                        html: '<div style="padding: 20px;"><h2>Reports & Analytics</h2><p>Select a report from the left panel to generate and view reports.</p></div>'
                    }]
                }];
            },
            
            createDashboardPanel: function() {
                return [{
                    region: 'north',
                    height: 120,
                    xtype: 'panel',
                    layout: 'hbox',
                    items: [
                        this.createStatsCard('Total Employees', '0', 'fa-users', '#4a90e2'),
                        this.createStatsCard('Departments', '0', 'fa-building', '#5cb85c'),
                        this.createStatsCard('Present Today', '0', 'fa-check-circle', '#5bc0de'),
                        this.createStatsCard('Pending Leaves', '0', 'fa-calendar', '#f0ad4e')
                    ]
                }, {
                    region: 'center',
                    xtype: 'tabpanel',
                    items: [{
                        title: 'Overview',
                        layout: 'border',
                        items: [{
                            region: 'center',
                            xtype: 'panel',
                            html: '<div id="dashboard-chart" style="height: 100%;"></div>',
                            listeners: {
                                afterrender: function() {
                                    HRApp.loadDashboardCharts();
                                }
                            }
                        }, {
                            region: 'east',
                            width: 300,
                            title: 'Recent Activities',
                            xtype: 'grid',
                            store: this.createStore('/api/recent-activities', {
                                id: 'number',
                                activity: 'string',
                                employee_name: 'string',
                                timestamp: 'date'
                            }),
                            columns: [
                                { text: 'Activity', dataIndex: 'activity', flex: 1 },
                                { text: 'Employee', dataIndex: 'employee_name', width: 120 },
                                { text: 'Time', dataIndex: 'timestamp', width: 80, xtype: 'datecolumn', format: 'H:i' }
                            ]
                        }]
                    }, {
                        title: 'Department Statistics',
                        layout: 'fit',
                        items: [{
                            xtype: 'grid',
                            store: this.createStore('/api/department-stats', {
                                department: 'string',
                                employees: 'number',
                                present: 'number',
                                absent: 'number',
                                late: 'number'
                            }),
                            columns: [
                                { text: 'Department', dataIndex: 'department', width: 150 },
                                { text: 'Total Employees', dataIndex: 'employees', width: 120 },
                                { text: 'Present', dataIndex: 'present', width: 80 },
                                { text: 'Absent', dataIndex: 'absent', width: 80 },
                                { text: 'Late', dataIndex: 'late', width: 80 },
                                { text: 'Attendance %', dataIndex: 'attendance_percentage', width: 100, xtype: 'numbercolumn', format: '0.0%' }
                            ]
                        }]
                    }]
                }];
            },
            
            createStatsCard: function(title, value, icon, color) {
                return {
                    flex: 1,
                    xtype: 'panel',
                    margin: '10 10 10 10',
                    style: `background: ${color}; color: white; border-radius: 8px;`,
                    bodyStyle: 'padding: 20px; text-align: center;',
                    html: `
                        <div style="font-size: 24px; margin-bottom: 10px;">
                            <i class="fa ${icon}"></i>
                        </div>
                        <div style="font-size: 28px; font-weight: bold; margin-bottom: 5px;">${value}</div>
                        <div style="font-size: 14px; opacity: 0.9;">${title}</div>
                    `
                };
            },
            
            createStore: function(url, fields) {
                return Ext.create('Ext.data.Store', {
                    fields: Object.keys(fields).map(key => ({ name: key, type: fields[key] })),
                    proxy: {
                        type: 'ajax',
                        url: url,
                        reader: {
                            type: 'json',
                            rootProperty: 'data'
                        }
                    },
                    autoLoad: true,
                    listeners: {
                        exception: function(proxy, response) {
                            console.error('Store load error:', response);
                            Ext.Msg.alert('Error', 'Failed to load data from server.');
                        }
                    }
                });
            },
            
            updateTaskbar: function() {
                const taskbarItems = document.getElementById('taskbar-items');
                taskbarItems.innerHTML = '';
                
                Object.keys(this.openWindows).forEach(module => {
                    const window = this.openWindows[module];
                    const item = document.createElement('div');
                    item.className = 'taskbar-item' + (window.isVisible() ? ' active' : '');
                    item.textContent = window.getTitle();
                    item.onclick = function() {
                        if (window.isVisible()) {
                            window.hide();
                        } else {
                            window.show();
                            window.toFront();
                        }
                    };
                    taskbarItems.appendChild(item);
                });
            },
            
            // Placeholder methods for form handling
            showEmployeeForm: function(mode) { this.showFormMessage('Employee Form', mode); },
            showDepartmentForm: function(mode) { this.showFormMessage('Department Form', mode); },
            showAttendanceForm: function(mode) { this.showFormMessage('Attendance Form', mode); },
            showPositionForm: function(mode) { this.showFormMessage('Position Form', mode); },
            showLeaveForm: function(mode) { this.showFormMessage('Leave Request Form', mode); },
            showEvaluationForm: function(mode) { this.showFormMessage('Evaluation Form', mode); },
            
            showFormMessage: function(formType, mode) {
                Ext.Msg.alert('Form', `${formType} ${mode || 'add'} functionality will be implemented with proper form validation and API integration.`);
            },
            
            deleteEmployee: function() { this.showDeleteMessage('Employee'); },
            deleteDepartment: function() { this.showDeleteMessage('Department'); },
            deletePosition: function() { this.showDeleteMessage('Position'); },
            
            showDeleteMessage: function(type) {
                Ext.Msg.confirm('Confirm Delete', `Are you sure you want to delete this ${type}?`, function(btn) {
                    if (btn === 'yes') {
                        Ext.Msg.alert('Success', `${type} deleted successfully!`);
                    }
                });
            },
            
            clockAction: function(action) {
                const message = action === 'in' ? 'Clocked in successfully!' : 'Clocked out successfully!';
                Ext.Msg.alert('Clock ' + action.toUpperCase(), message);
            },
            
            approveLeave: function() { Ext.Msg.alert('Success', 'Leave request approved!'); },
            rejectLeave: function() { Ext.Msg.alert('Success', 'Leave request rejected!'); },
            
            viewEvaluationDetails: function() { Ext.Msg.alert('Evaluation Details', 'Detailed evaluation view will be implemented.'); },
            
            generateReport: function(reportType) {
                const reportsTab = Ext.getCmp('reports-tabs');
                const existingTab = reportsTab.child(`[reportType="${reportType}"]`);
                
                if (existingTab) {
                    reportsTab.setActiveTab(existingTab);
                } else {
                    const newTab = reportsTab.add({
                        title: reportType.replace('-', ' ').toUpperCase(),
                        reportType: reportType,
                        closable: true,
                        html: `<div style="padding: 20px;"><h3>Report: ${reportType}</h3><p>Report data will be loaded here...</p></div>`
                    });
                    reportsTab.setActiveTab(newTab);
                }
            },
            
            loadDashboardCharts: function() {
                // Placeholder for dashboard chart loading
                document.getElementById('dashboard-chart').innerHTML = 
                    '<div style="padding: 50px; text-align: center; color: #666;">' +
                    '<h3>Dashboard Charts</h3>' +
                    '<p>Charts and analytics will be displayed here using Chart.js or similar library.</p>' +
                    '</div>';
            },
            
            toggleStartMenu: function() {
                Ext.Msg.alert('Start Menu', 'Start menu functionality can be implemented with additional desktop applications and settings.');
            }
        };

        // Initialize application when ExtJS is ready
        Ext.onReady(function() {
            HRApp.init();
            
            // Show welcome message
            setTimeout(function() {
                Ext.Msg.alert('HR Management System', 'Welcome to the HR Management System!<br><br>Click on desktop icons to open different modules.');
            }, 1000);
        });
    </script>
</body>
</html>